- artworkSize = artworkSize || 'medium'
- imageWidth = imageWidth || false
- displayPurchase = displayPurchase || false
- showBlurbs = showBlurbs || false
- isAuction = isAuction || (set && set.get('type') === 'auction artworks') || false
- displayPrice != null ? displayPrice : displayPrice = true
- saleArtwork = artwork.related().saleArtwork

figure.artwork-item( data-artwork=artwork.get('id') )
  .artwork-item-image-container
    a.artwork-item-image-link(href=artwork.href())
      if imageWidth
        include ./fixed_width_image
      else
        include ./variable_width_image
      if artwork.collection && artwork.collection.artworkCollection
        .artwork-item-remove.icon-remove-small(
          data-id=artwork.get('id')
          data-collection-id=artwork.collection.artworkCollection.id
        )
      if sd && sd.CURRENT_USER && sd.CURRENT_USER.lab_features && sd.CURRENT_USER.lab_features.indexOf('Set Management') != -1
        include ../save_controls_two_btn/templates/controls
      else
        include ../save_controls/template
  figcaption.artwork-item-caption
    if artwork.has('artist')
      p.artwork-item-artist.artwork-item-overflow
        if artwork.get('artist').public
          a.faux-underline-hover( href=artwork.artistLink() )= artwork.artistName()
        else
          = artwork.artistName()
    if isAuction && artwork.related().saleArtwork && artwork.related().saleArtwork.get('lot_number')
      .artwork-item-lot-number Lot #{artwork.related().saleArtwork.get('lot_number')}
    p.artwork-item-title.artwork-item-overflow!= artwork.titleAndYear()
    if artwork.partnerName()
      //- Note: if the <a..> is in a <p..> text-overflow ellipsis doesn't work
      p.artwork-item-partner.artwork-item-overflow
        if artwork.partnerLink()
          a.faux-underline-hover( href=artwork.partnerLink() )= artwork.partnerName()
        else
          = artwork.partnerName()

    //- Display price for non-auctions
    if artwork.saleMessage() && displayPrice && !isAuction
      p.artwork-item-sale-price= artwork.saleMessage()

    //- Auction estimate
    if saleArtwork.id && isAuction
      - var estimate = saleArtwork.estimate()
      if estimate
        .artwork-item-estimate
          | Estimate: #{estimate}

    //- Auction related pricing information
    - var displayBidStatus = saleArtwork.id && isAuction
    - var displayBuyNowPrice = artwork.saleMessage() && displayPrice && isAuction
    if displayBuyNowPrice || displayBidStatus
      .artwork-item-sale-metadata
        if artwork.get('sold')
          .artwork-item-buy-now-price
            = artwork.saleMessage()
        else
          if displayBidStatus
            - var saleArtwork = artwork.related().saleArtwork
            .artwork-item-auction-bid-status
              | #{saleArtwork.bidLabel()}: #{saleArtwork.currentBid()}
              if saleArtwork.get('bidder_positions_count') >= 1
                | &nbsp;(#{saleArtwork.bidCount()})

          if displayBuyNowPrice
            .artwork-item-buy-now-price
              | Buy Now Price: #{artwork.saleMessage()}

    //- In the case of auctions this blurb is usually an estimate
    if saleArtwork.id || showBlurbs
      - var saleArtwork = artwork.related().saleArtwork
      if artwork.has('blurb') && artwork.get('blurb')
        .artwork-item-blurb!= artwork.mdToHtml('blurb')
      else
        if saleArtwork && saleArtwork.get('user_notes')
          .artwork-item-blurb!= saleArtwork.mdToHtml('user_notes')

    if saleArtwork.id || showBlurbs
      a.artwork-item-more-info.avant-garde-button-black.is-tiny(
        href=artwork.href()
        data-id=artwork.get('_id')
      ) More Info

    if isAuction && !artwork.get('sold')
      a.artwork-item-bid.avant-garde-button-black.is-tiny(
        href=artwork.href()
        data-id=artwork.get('_id')
      ) Bid

      if artwork.get('acquireable')
        a.artwork-item-buy-now.avant-garde-button-black.is-tiny(
          href=artwork.href(), data-id=artwork.get('id')
        ) Buy Now

    if displayPurchase && !isAuction
      if artwork.get('acquireable')
        a.artwork-item-buy.avant-garde-button-black.is-tiny(
          href=artwork.href(), data-id=artwork.get('id')
        ) Buy
      else if artwork.get('sold')
        .artwork-item-sold.avant-garde-button-black.is-tiny Sold
      else if artwork.isContactable()
        a.artwork-item-contact-seller.avant-garde-button-black.is-tiny(
          href=artwork.href(), data-id=artwork.get('id')
        ) Contact #{artwork.contactLabel()}

    if artwork.collection && artwork.collection.artworkCollection
      a.artwork-item-collection-name(
        href=(sd.CURRENT_USER.default_profile_id + '/collection/' +
              artwork.collection.artworkCollection.get('id'))
      )
        = artwork.collection.artworkCollection.get('name')
