include ../../article_figure/mixin
include ./share

mixin author-date
  .article-author-date
    .article-author
      a( href="/#{article.related().author.get('profile_handle')}" )
        = article.related().author.get('name')
    .article-contributing-author
      include ../../article_figure/contributing_author.jade
    .article-date
      = moment(article.get('published_at')).format('MMM Do, YYYY h:mm a')

mixin video(video)
  .article-video-container
    if video.cover_image_url
      .article-video-cover-image(
        style=("background-image: url(#{resize(video.cover_image_url, { width: 1100 })})")
      )
        button.article-video-play-button
          .article-video-play-button-caret
    .article-video
      != embedVideo(video.url, videoOptions)

mixin image(image)
  figure.article-section-image
    img( src=resize(image.url, { width: 1100 }) )
    if image.caption
      figcaption!= image.caption

mixin fullscreen(article)
  figure.article-fullscreen-video( class= article.get('is_super_article') ? 'article-sa-fullscreen-video' : '' )
    if article.get('hero_section').background_url
      .article-fullscreen-video-container
        .article-fullscreen-video-overlay
        video.article-fullscreen-video-player( src=article.get('hero_section').background_url, autoplay=true, controls=false, loop=true)
    .main-layout-container
      if article.get('is_super_article')
        .article-sa-primary-logos
          a( href="/" ).article-sa-artsy-logo.icon-logotype
          .article-sa-primary-logo
            if article.get('super_article').partner_logo && article.get('super_article').partner_link
              a( href=article.get('super_article').partner_link )
                img( src=article.get('super_article').partner_logo )
      .article-fullscreen-text-overlay
        if article.get('hero_section').title
          h1.large-garamond-header.article-fullscreen-title= article.get('title')
        if !article.get('is_super_article')
          +author-date
         if article.get('hero_section').intro
          .article-lead-paragraph.article-fullscreen-intro.!= article.get('hero_section').intro
      if article.get('is_super_article')
        .article-sa-related-container
          .article-sa-related
            for relatedArticle in relatedArticles.models
              a( href=relatedArticle.href() )= relatedArticle.get('title') 
        .article-share-fixed-fullscreen(data-id=article.get('id'))
          +share-fixed(article.get('title'), article.get('thumbnail_image'), article.fullHref())

//- Super article header needs to be outside the article-container
if superArticle
  include ./super_article_sticky_header.jade

.article-container(data-id=article.get('id'))

  //- Article Share Fixed Nav
  .article-share-fixed(data-id=article.get('id'))
    +share-fixed(article.get('title'), article.get('thumbnail_image'), article.fullHref())

  if article.get('hero_section') && article.get('hero_section').type === 'fullscreen'
    +fullscreen(article)

  .article-content( class=(article.get('hero_section') && article.get('hero_section').type === 'fullscreen' ? 'article-fullscreen-content' : '') )
    //- Nesting to support fullscreen content going over fullscreen header
    .article-fullscreen-content-container
      //- Article lead content
      if article.get('hero_section') && article.get('hero_section').type === 'video'
        .article-large-format-video-container
          +video(article.get('hero_section'))
      if article.get('hero_section') && article.get('hero_section').type === 'image'
        .article-large-format-image
          +image(article.get('hero_section'))
      h1.large-garamond-header= article.get('title')
      if article.strip('lead_paragraph')
        .article-lead-paragraph
          != article.get('lead_paragraph')
      +author-date
      .article-social.article-share-top
        +share(article.get('title'), article.get('thumbnail_image'), article.fullHref())

      //- Article body content
      if article.get('sections').length && article.get('sections')[0].type == 'slideshow'
        .article-carousel
          include carousel
      for section, i in article.get('sections')
        .article-section-container
          case section.type
            when 'text'
              .article-section-text!= section.body
            when 'artworks'
              .article-section-artworks.is-loading( data-layout=section.layout )
                .loading-spinner
                ul
                  for id in section.ids
                    li( data-id=id )
            when 'image'
              .article-section-image
                +image(section)
            when 'video'
              .article-section-video
                +video(section)
            when 'embed'
              .article-section-embed( data-id=section.url data-layout=section.layout )
                .loading-spinner
                .article-embed-container

      //- Footer social buttons
      .article-social.add-bottom.article-share-bottom
        h2.article-social__header Share this article
        +share(article.get('title'), article.get('thumbnail_image'), (sd.APP_URL + '/article/' + article.get('slug')))

      if superArticle
        include ./super_article_footer.jade

.articles-featured-section-articles.article-related-widget( data-id = article.get('id') )
  //- Rendered on client
